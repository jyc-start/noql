{
  "where": {
    "case-1": {
      "expectedResults": [
        {
          "o": {
            "id": 1,
            "item": "almonds",
            "price": 12,
            "quantity": 2,
            "customerId": 1,
            "specialChars": "^^^"
          },
          "i": [
            {
              "id": 1,
              "sku": "almonds",
              "description": "product 1",
              "instock": 120,
              "specialChars": "^^^"
            }
          ]
        }
      ]
    },
    "case-2": {
      "expectedResults": [
        {
          "o": {
            "id": 1,
            "item": "almonds",
            "price": 12,
            "quantity": 2,
            "customerId": 1,
            "specialChars": "^^^"
          },
          "i": [
            {
              "id": 1,
              "sku": "almonds",
              "description": "product 1",
              "instock": 120,
              "specialChars": "^^^"
            }
          ]
        }
      ]
    },
    "case-3": {
      "expectedResults": [
        {
          "o": {
            "id": 1,
            "item": "almonds",
            "price": 12,
            "quantity": 2,
            "customerId": 1,
            "specialChars": "^^^"
          },
          "i": [
            {
              "id": 1,
              "sku": "almonds",
              "description": "product 1",
              "instock": 120,
              "specialChars": "^^^"
            },
            {
              "id": 2,
              "sku": "bread",
              "description": "product 2",
              "instock": 80,
              "specialChars": "!!$"
            },
            {
              "id": 3,
              "sku": "cashews",
              "description": "product 3",
              "instock": 60,
              "specialChars": "!!\""
            },
            {
              "id": 4,
              "sku": "pecans",
              "description": "product 4",
              "instock": 70,
              "specialChars": "!!*"
            }
          ]
        }
      ]
    },
    "case-4": {
      "expectedResults": [
        {
          "o": {
            "id": 1,
            "item": "almonds",
            "price": 12,
            "quantity": 2,
            "customerId": 1,
            "specialChars": "^^^"
          },
          "i": [
            {
              "id": 1,
              "sku": "almonds",
              "description": "product 1",
              "instock": 120,
              "specialChars": "^^^"
            }
          ]
        }
      ],
      "pipeline": [
        {
          "$project": {
            "o": "$$ROOT"
          }
        },
        {
          "$lookup": {
            "from": "inventory",
            "as": "i",
            "let": {
              "o_item": "$o.item",
              "o_price": "$o.price"
            },
            "pipeline": [
              {
                "$match": {
                  "$expr": {
                    "$or": [
                      {
                        "$gte": [
                          "$instock",
                          0
                        ]
                      },
                      {
                        "$gte": [
                          "$$o_price",
                          0
                        ]
                      }
                    ]
                  }
                }
              },
              {
                "$match": {
                  "$expr": {
                    "$eq": [
                      "$sku",
                      "$$o_item"
                    ]
                  }
                }
              }
            ]
          }
        },
        {
          "$match": {
            "$expr": {
              "$gt": [
                {
                  "$size": "$i"
                },
                0
              ]
            }
          }
        },
        {
          "$unset": [
            "_id",
            "o._id",
            "i._id",
            "o.orderDate"
          ]
        },
        {
          "$limit": 1
        }
      ]
    },
    "case-5": {
      "pipeline": [
        {
          "$project": {
            "o": "$$ROOT"
          }
        },
        {
          "$lookup": {
            "from": "inventory",
            "as": "i",
            "let": {
              "o_item": "$o.item"
            },
            "pipeline": [
              {
                "$match": {
                  "$expr": {
                    "$or": [
                      {
                        "$gte": [
                          "$id",
                          0
                        ]
                      },
                      {
                        "$gte": [
                          "$instock",
                          0
                        ]
                      }
                    ]
                  }
                }
              },
              {
                "$match": {
                  "$expr": {
                    "$eq": [
                      "$sku",
                      "$$o_item"
                    ]
                  }
                }
              }
            ]
          }
        },
        {
          "$match": {
            "$expr": {
              "$gt": [
                {
                  "$size": "$i"
                },
                0
              ]
            }
          }
        },
        {
          "$unset": [
            "_id",
            "o._id",
            "i._id",
            "o.orderDate"
          ]
        },
        {
          "$limit": 1
        }
      ],
      "expectedResults": [
        {
          "o": {
            "id": 1,
            "item": "almonds",
            "price": 12,
            "quantity": 2,
            "customerId": 1,
            "specialChars": "^^^"
          },
          "i": [
            {
              "id": 1,
              "sku": "almonds",
              "description": "product 1",
              "instock": 120,
              "specialChars": "^^^"
            }
          ]
        }
      ]
    },
    "case-7": {
      "expectedResults": [
        {
          "o": {
            "id": 1,
            "item": "almonds",
            "price": 12,
            "quantity": 2,
            "customerId": 1,
            "specialChars": "^^^"
          },
          "i": [
            {
              "id": 1,
              "sku": "almonds",
              "description": "product 1",
              "instock": 120,
              "specialChars": "^^^"
            }
          ]
        }
      ]
    },
    "case-8": {
      "pipeline": [
        {
          "$project": {
            "o": "$$ROOT"
          }
        },
        {
          "$match": {
            "o.id": {
              "$gte": 0
            }
          }
        },
        {
          "$lookup": {
            "from": "inventory",
            "as": "i",
            "localField": "o.item",
            "foreignField": "sku"
          }
        },
        {
          "$match": {
            "$expr": {
              "$gt": [
                {
                  "$size": "$i"
                },
                0
              ]
            }
          }
        },
        {
          "$unset": [
            "_id",
            "o._id",
            "i._id",
            "o.orderDate"
          ]
        },
        {
          "$limit": 1
        }
      ],
      "expectedResults": [
        {
          "o": {
            "id": 1,
            "item": "almonds",
            "price": 12,
            "quantity": 2,
            "customerId": 1,
            "specialChars": "^^^"
          },
          "i": [
            {
              "id": 1,
              "sku": "almonds",
              "description": "product 1",
              "instock": 120,
              "specialChars": "^^^"
            }
          ]
        }
      ]
    },
    "case-6": {
      "pipeline": [
        {
          "$project": {
            "o": "$$ROOT"
          }
        },
        {
          "$lookup": {
            "from": "inventory",
            "as": "i",
            "let": {
              "o_item": "$o.item"
            },
            "pipeline": [
              {
                "$match": {
                  "$expr": {
                    "$or": [
                      {
                        "$gt": [
                          "$id",
                          0
                        ]
                      },
                      {
                        "$gte": [
                          "$id",
                          0
                        ]
                      },
                      {
                        "$gte": [
                          "$instock",
                          0
                        ]
                      }
                    ]
                  }
                }
              },
              {
                "$match": {
                  "$expr": {
                    "$eq": [
                      "$sku",
                      "$$o_item"
                    ]
                  }
                }
              }
            ]
          }
        },
        {
          "$match": {
            "$expr": {
              "$gt": [
                {
                  "$size": "$i"
                },
                0
              ]
            }
          }
        },
        {
          "$unset": [
            "_id",
            "o._id",
            "i._id",
            "o.orderDate"
          ]
        },
        {
          "$limit": 1
        }
      ],
      "expectedResults": [
        {
          "o": {
            "id": 1,
            "item": "almonds",
            "price": 12,
            "quantity": 2,
            "customerId": 1,
            "specialChars": "^^^"
          },
          "i": [
            {
              "id": 1,
              "sku": "almonds",
              "description": "product 1",
              "instock": 120,
              "specialChars": "^^^"
            }
          ]
        }
      ]
    },
    "case-9": {
      "pipeline": [
        {
          "$project": {
            "o": "$$ROOT"
          }
        },
        {
          "$lookup": {
            "from": "inventory",
            "as": "i",
            "let": {
              "o_item": "$o.item",
              "o_price": "$o.price"
            },
            "pipeline": [
              {
                "$match": {
                  "$expr": {
                    "$or": [
                      {
                        "$gte": [
                          "$instock",
                          0
                        ]
                      },
                      {
                        "$gte": [
                          "$$o_price",
                          0
                        ]
                      }
                    ]
                  }
                }
              },
              {
                "$match": {
                  "$expr": {
                    "$eq": [
                      "$sku",
                      "$$o_item"
                    ]
                  }
                }
              }
            ]
          }
        },
        {
          "$match": {
            "$expr": {
              "$gt": [
                {
                  "$size": "$i"
                },
                0
              ]
            }
          }
        },
        {
          "$match": {
            "$expr": {
              "$eq": [
                1,
                1
              ]
            }
          }
        },
        {
          "$unset": [
            "_id",
            "o._id",
            "i._id",
            "o.orderDate"
          ]
        },
        {
          "$limit": 1
        }
      ],
      "expectedResults": [
        {
          "o": {
            "id": 1,
            "item": "almonds",
            "price": 12,
            "quantity": 2,
            "customerId": 1,
            "specialChars": "^^^"
          },
          "i": [
            {
              "id": 1,
              "sku": "almonds",
              "description": "product 1",
              "instock": 120,
              "specialChars": "^^^"
            }
          ]
        }
      ]
    }
  }
}